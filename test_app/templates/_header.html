
<!-- Early theme init to avoid flash -->
<script>(function(){try{var k='arcadia.theme',t=null;try{t=localStorage.getItem(k);}catch(e){} if(!t){try{var m=document.cookie.match(/(?:^|; )theme=([^;]+)/); t=m?decodeURIComponent(m[1]):null;}catch(e){}} if(!t){t=(window.matchMedia&&matchMedia('(prefers-color-scheme: dark)').matches)?'dark':'light';}var de=document.documentElement;de.classList.add(t==='dark'?'theme-dark':'theme-light','no-theme-transitions');var meta=document.createElement('meta');meta.name='color-scheme';meta.content=(t==='dark')?'dark light':'light dark';document.head.appendChild(meta);document.addEventListener('DOMContentLoaded',function(){de.classList.remove('no-theme-transitions');},{once:true});}catch(e){}})();</script>
<link rel="stylesheet" href="/ui-static/arcadia_theme.css">

<!-- Shared application header -->
<style>
  /* Sticky footer layout: header + content + footer; footer stays at bottom on short pages */
  html, body { height: 100%; }
  body { min-height: 100vh; display: flex; flex-direction: column; }
  #arcadia-content { flex: 1 0 auto; }
  :root { scrollbar-gutter: stable; }
  .tm-header, .tm-header *, .tm-header *::before, .tm-header *::after { box-sizing: border-box; }
  .tm-header { background:var(--header-bg, var(--bg)); color:var(--header-fg, var(--fg)); border-bottom:1px solid var(--header-border, var(--border)); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; font-size:14px; line-height:1.25; }
  .tm-header .tm-container { max-width:1200px; margin:0 auto; padding:0.75rem 1rem; display:flex; align-items:center; justify-content:space-between; }
  @media (min-width: 640px){ .tm-header .tm-container { min-height:56px; } }
  .tm-header .tm-brand { color:var(--header-fg, var(--fg)); font-weight:600; text-decoration:none; letter-spacing:0.2px; font-size:18px; }
  .tm-header .tm-nav a { color:var(--link-muted); text-decoration:none; margin-left:1rem; font-size:14px; }
  .tm-header .tm-nav a:hover { color:var(--link); }
  .tm-right { display:flex; align-items:center; gap:1rem; }
  .tm-actions .tm-btn { padding:0.35rem 0.75rem; border:1px solid var(--header-border, var(--border)); border-radius:0.375rem; color:var(--header-fg, var(--fg)); text-decoration:none; font-size:14px; background:transparent; }
  .tm-actions .tm-btn:hover { background:transparent; }
  .tm-actions .tm-primary { border-color:var(--primary); background:var(--primary); color:var(--btn-fg, #fff); }
  .tm-user { position:relative; }
  .tm-user-btn { padding:0.35rem 0.75rem; border:1px solid var(--header-border, var(--border)); border-radius:0.375rem; color:var(--header-fg, var(--fg)); background:transparent; cursor:pointer; font-size:14px; }
  .tm-user-menu { position:absolute; right:0; top:2.25rem; background:var(--panel); border:1px solid var(--border); border-radius:0.375rem; min-width:180px; display:none; z-index:50; }
  .tm-user:focus-within .tm-user-menu { display:block; }
  .tm-user-menu a { display:block; padding:0.5rem 0.75rem; color:var(--fg); text-decoration:none; font-size:14px; }
  .tm-user-menu a:hover { background:var(--border); }
  .tm-divider { width:1px; height:18px; background:var(--border); margin:0 0.5rem; }
  .tm-nav a.active { color:var(--fg); }
  .tm-brand small { color:var(--muted); font-weight:400; font-size:12px; margin-left:6px; }
  .tm-flex { display:flex; align-items:center; gap:.75rem; }
  .tm-nav { display:flex; align-items:center; }
  @media (max-width: 640px){ .tm-nav a { margin-left:.5rem; } }
  .tm-link { color:#9ca3af; }
  .tm-link:hover { color:#f9fafb; }
  .tm-hidden { display:none; }
  .tm-show { display:block; }
  .tm-menu-right { position:relative; }
  .tm-user-menu hr { border:none; border-top:1px solid #1f2937; margin:4px 0; }
</style>
<header class="tm-header t-header">
  <div class="tm-container">
    <a class="tm-brand" href="{{ brand_home_url or '/' }}">
      {% if brand_logo_url %}<img src="{{ brand_logo_url }}" alt="logo" style="height:22px;vertical-align:middle;margin-right:8px;"/>{% endif %}
      {{ brand_name or 'Project Name' }}<small>{{ brand_tag or '' }}</small>
    </a>
    <div class="tm-right"> 
      {% set _nav = nav_items if (nav_items is defined) else [] %}
      {% if _nav and _nav|length > 0 %}
        <nav class="tm-nav" aria-label="Primary"> 
          {% for it in _nav %}
            <a href="{{ it.href }}" class="tm-link{% if it.active %} active{% endif %}">{{ it.label }}</a>
          {% endfor %}
        </nav>
      {% endif %}
      {% if request and request.state and request.state.user %} 
        <div class="tm-user" id="tm-user">
          <button class="tm-user-btn" id="tm-user-btn">Account â–¾</button>
          <div class="tm-user-menu" id="tm-user-menu">
            <button class="tm-menu-trigger" id="theme-menu-trigger">Theme</button>
            <div id="theme-submenu" style="display:none; position:absolute; right: 100%; top: 0; z-index: 3000;"></div>
            <a href="/account">Account</a>
            <a href="/settings">Settings</a>
            <hr />
            <a href="/auth/logout">Log out</a>
          </div>
        </div>
      {% else %}
        <div class="tm-actions">
          <a href="/login" class="tm-btn">Log in</a>
          <a href="/signup" class="tm-btn tm-primary">Sign up</a>
        </div>
      {% endif %}
    </div>
  </div>
</header>
<!-- Dropdown uses CSS :focus-within; no JS needed -->
{% set __persist = persist_header if persist_header is defined else true %}
{% if __persist %}
<script src="/ui-static/contextmenu.js"></script>
<script src="https://unpkg.com/htmx.org@1.9.12" integrity="sha384-+bVsx3b8QdE7cO1S4oFQ9hQ1TImfQxWqS4LzJd8j3jL5uFQw8L7f3NfL2hJdJg9w" crossorigin="anonymous"></script>
<script>
// Enable header persistence via htmx: boost links/forms and swap only #arcadia-content
(function(){
  try{
    var b=document.body; if(!b) return;
    b.setAttribute('hx-boost','true');
    b.setAttribute('hx-target','#arcadia-content');
    b.setAttribute('hx-select','#arcadia-content');
    b.setAttribute('hx-swap','innerHTML');
    b.setAttribute('hx-push-url','true');
  }catch(e){}
})();
</script>
<!-- App-neutral UI re-init event; apps can hook `ui:reinit` to (re)initialize features -->
<script>
(function(){
  try{
    try{
      document.body.addEventListener('htmx:beforeSwap', function(){ try{ document.documentElement.classList.add('no-theme-transitions'); }catch{} });
      document.body.addEventListener('htmx:afterSwap', function(){ try{ document.documentElement.classList.remove('no-theme-transitions'); }catch{} });
    }catch(e){}
    function fire(){
      try{ window.dispatchEvent(new CustomEvent('ui:reinit')); }catch(e){}
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fire, { once: true });
    } else {
      fire();
    }
    try{ document.body.addEventListener('htmx:afterSwap', fire); }catch(e){}
    document.addEventListener('visibilitychange', function(){ if(document.visibilityState==='visible') fire(); });
  }catch(e){}
})();
</script>
{% endif %}
            
