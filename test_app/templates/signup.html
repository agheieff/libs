<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign up - Arcadia</title>
    <style>
      .auth-wrap{max-width:420px;margin:48px auto;background:var(--panel);border:1px solid var(--border);border-radius:8px;padding:18px}
      .auth-title{font-size:20px;font-weight:600;margin:0 0 12px;color:var(--fg)}
      .auth-label{font-size:13px;margin:8px 0 4px;color:var(--muted)}
      .auth-input{width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:6px;background:var(--bg);color:var(--fg)}
      .auth-btn{width:100%;padding:10px 12px;border-radius:6px}
      .auth-error{font-size:13px;color:#b91c1c;display:none;margin-top:8px}
      .hint{font-size:.85rem;color:var(--muted)}
      body{background:var(--bg)}
    </style>
</head>
<body class="bg-gray-100 min-h-screen" style="margin:0;">
    {% include "_header.html" ignore missing %}
    <div id="arcadia-content">
    <div class="auth-wrap">
        <h1 class="auth-title">Create your account</h1>
        <form id="signup-form" class="space-y-4" onsubmit="return false;">
            <div>
                <div class="auth-label">Email</div>
                <input id="email" type="email" class="auth-input" required />
            </div>
            <div>
                <div class="auth-label">Password</div>
                <input id="password" type="password" class="auth-input" required />
                <div class="hint">At least 8 characters</div>
            </div>
            <button id="signup-btn" class="t-btn t-btn-primary auth-btn">Sign up</button>
            <p id="signup-error" class="auth-error"></p>
        </form>
    </div>
    <script>
    function extractErrorMessage(data, fallback) {
        if (!data) return fallback;
        const d = data.detail;
        if (typeof d === 'string') return d;
        if (Array.isArray(d) && d.length) {
            const first = d[0] || {};
            const loc = first.loc || [];
            if (loc.includes('password')) return 'Password must be at least 8 characters.';
            if (loc.includes('email')) return 'Please enter a valid email address.';
            return first.msg || fallback;
        }
        return fallback;
    }
    document.getElementById('signup-btn').addEventListener('click', async () => {
        const email = (document.getElementById('email').value || '').trim();
        const password = document.getElementById('password').value || '';
        const err = document.getElementById('signup-error');
        err.style.display = 'none';
        try {
            const res = await fetch('/auth/register', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email, password })
            });
            if (!res.ok) {
                const d = await res.json().catch(()=>null);
                throw new Error(extractErrorMessage(d, 'Sign up failed'));
            }
            const res2 = await fetch('/auth/login', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email, password })
            });
            if (!res2.ok) {
                const d2 = await res2.json().catch(()=>null);
                throw new Error(extractErrorMessage(d2, 'Login failed'));
            }
            const data = await res2.json();
            try {
                document.cookie = `access_token=${data.access_token}; Path=/; SameSite=Lax`;
            } catch {}
            window.location.href = '/';
        } catch (e) {
            err.textContent = e.message || 'Sign up failed';
            err.style.display = 'block';
        }
    });
    </script>
    
</div>
    {% include "_footer.html" ignore missing %}
</body>
</html>
